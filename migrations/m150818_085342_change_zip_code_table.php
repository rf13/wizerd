<?php

use yii\db\Schema;
use yii\db\Migration;

class m150818_085342_change_zip_code_table extends Migration
{
    public function safeUp()
    {
        $this->dropColumn('zip_code', 'state');
        $this->dropColumn('zip_code', 'state_code');
        $this->dropColumn('zip_code', 'country');
        $this->dropColumn('zip_code', 'latitude');
        $this->dropColumn('zip_code', 'longitude');

        $this->renameColumn('zip_code', 'city', 'city_id');
        $this->alterColumn('zip_code', 'city_id', 'integer NOT NULL');

        $this->createIndex('zip_code_city_id_key', 'zip_code', 'city_id');
        $this->addForeignKey('fk_zip_code_city_id', 'zip_code', 'city_id', 'city', 'id', 'CASCADE', 'RESTRICT');

        $this->batchInsert('zip_code', ['zip', 'city_id', 'active'], [
            [00601, 1, 1],  [00602, 2, 1],  [00603, 3, 1],  [00604, 3, 1],  [00605, 3, 1],
            [00606, 4, 1],  [00610, 5, 1],  [00611, 6, 1],  [00612, 7, 1],  [00613, 7, 1],
            [00614, 7, 1],  [00616, 8, 1],  [00617, 9, 1],  [00622, 10, 1], [00623, 11, 1],
            [00624, 12, 1], [00627, 13, 1], [00631, 14, 1], [00636, 15, 1], [00637, 16, 1],
            [00638, 17, 1], [00641, 18, 1], [00646, 19, 1], [00647, 20, 1], [00650, 21, 1],
            [00652, 22, 1], [00653, 23, 1], [00656, 24, 1], [00659, 25, 1], [00660, 26, 1],
            [00662, 27, 1], [00664, 28, 1], [00667, 29, 1], [00669, 30, 1], [00670, 31, 1],
            [00674, 32, 1], [00676, 33, 1], [00677, 34, 1], [00678, 35, 1], [00680, 36, 1],
            [00681, 36, 1], [00682, 36, 1], [00683, 37, 1], [00685, 38, 1], [00687, 39, 1],
            [00688, 40, 1], [00690, 41, 1], [00692, 42, 1], [00693, 43, 1], [00694, 43, 1],
            [00698, 44, 1], [00703, 45, 1], [00704, 46, 1], [00705, 47, 1], [00707, 48, 1],
            [00714, 49, 1], [00715, 50, 1], [00716, 51, 1], [00717, 51, 1], [00718, 52, 1],
            [00719, 53, 1], [00720, 54, 1], [00721, 55, 1], [00723, 56, 1], [00725, 57, 1],
            [00726, 57, 1], [00727, 57, 1], [00728, 51, 1], [00729, 58, 1], [00730, 51, 1],
            [00731, 51, 1], [00732, 51, 1], [00733, 51, 1], [00734, 51, 1], [00735, 59, 1],
            [00736, 60, 1], [00737, 60, 1], [00738, 61, 1], [00739, 62, 1], [00740, 63, 1],
            [00741, 64, 1], [00742, 65, 1], [00744, 66, 1], [00745, 67, 1], [00751, 68, 1],
            [00754, 69, 1], [00757, 70, 1], [00765, 71, 1], [00766, 72, 1], [00767, 73, 1],
            [00769, 74, 1], [00771, 75, 1], [00772, 76, 1], [00773, 77, 1], [00775, 78, 1],
            [00777, 79, 1], [00778, 80, 1], [00780, 81, 1], [00782, 82, 1], [00783, 83, 1],
            [00784, 84, 1], [00785, 84, 1], [00786, 85, 1], [00791, 86, 1], [00792, 86, 1],
            [00794, 87, 1], [00795, 88, 1]
        ]);
    }

    public function safeDown()
    {
        $zip_codes = [
            00601, 00602, 00603, 00604, 00605, 00606, 00610, 00611, 00612, 00613, 00614, 00616,
            00617, 00622, 00623, 00624, 00627, 00631, 00636, 00637, 00638, 00641, 00646, 00647,
            00650, 00652, 00653, 00656, 00659, 00660, 00662, 00664, 00667, 00669, 00670, 00674,
            00676, 00677, 00678, 00680, 00681, 00682, 00683, 00685, 00687, 00688, 00690, 00692,
            00693, 00694, 00698, 00703, 00704, 00705, 00707, 00714, 00715, 00716, 00717, 00718,
            00719, 00720, 00721, 00723, 00725, 00726, 00727, 00728, 00729, 00730, 00731, 00732,
            00733, 00734, 00735, 00736, 00737, 00738, 00739, 00740, 00741, 00742, 00744, 00745,
            00751, 00754, 00757, 00765, 00766, 00767, 00769, 00771, 00772, 00773, 00775, 00777,
            00778, 00780, 00782, 00783, 00784, 00785, 00786, 00791, 00792, 00794, 00795
        ];
        $this->delete('zip_code', ['zip' => $zip_codes]);
        
        $this->dropForeignKey('fk_zip_code_city_id', 'zip_code');
        $this->dropIndex('zip_code_city_id_key', 'zip_code');
        
        $this->alterColumn('zip_code', 'city_id', 'string');
        $this->renameColumn('zip_code', 'city_id', 'city');

        $this->addColumn('zip_code', 'state', $this->string());
        $this->addColumn('zip_code', 'state_code', $this->string());
        $this->addColumn('zip_code', 'country', $this->string());
        $this->addColumn('zip_code', 'latitude', $this->float(2));
        $this->addColumn('zip_code', 'longitude', $this->float(2));
        
    }
}